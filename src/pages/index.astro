---
import Layout from "../layouts/Layout.astro";
---

<Layout>
	<!-- Intro Overlay -->
	<div class="intro-overlay" id="intro">
		<div class="intro-content">
			<h1 class="intro-title">CHOPPD</h1>
			<p class="intro-subtitle">VIM Command training center</p>
			<button class="enter-btn" id="enterBtn">INITIALIZE TERMINAL</button>
		</div>
	</div>

	<!-- Main Content -->
	<div class="main-content" id="mainContent">
		<!-- Control Diagram / Navigation Hints -->
		<div class="nav-hints">
			<div class="nav-hint up">
				<span>UP</span>
				<small>Page Up</small>
			</div>
			<div class="nav-hint down">
				<span>DOWN</span>
				<small>Page Down</small>
			</div>
			<div class="nav-hint left">
				<span>LEFT</span>
				<small>Tool Kit</small>
			</div>
			<div class="nav-hint right">
				<span>RIGHT</span>
				<small>Agent OS</small>
			</div>
		</div>

		<!-- Central Terminal -->
		<div class="terminal-container">
			<div class="terminal-header">
				<span class="status-dot"></span>
				<span class="terminal-title">VIM://Frontier_Training</span>
			</div>
			<div class="terminal-window" id="terminalWindow">
				<div class="output-log" id="outputLog">
					<div class="line system">
						Welcome to CHOPPD Agentic Playground.
					</div>
					<div class="line warning">
						WARNING: VIM Knowledge Required for Navigation.
					</div>
					<div class="line info">
						Type <span class="cmd">:help</span> for available commands.
					</div>
					<div class="line link">
						New to Vim? <a
							href="https://vim.fandom.com/wiki/Tutorial"
							target="_blank">Access Knowledge Base</a
						>
					</div>
				</div>
				<div class="input-line">
					<span class="prompt">~</span>
					<input
						type="text"
						id="vimInput"
						class="vim-input"
						autocomplete="off"
						spellcheck="false"
						autofocus
					/>
					<span class="cursor-block"></span>
				</div>
			</div>
		</div>

		<!-- API configuration moved to Agent Station in WesternOS -->
	</div>
</Layout>

<style>
	/* Intro Overlay */
	.intro-overlay {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: radial-gradient(circle at center, #0d001a 0%, #050505 100%);
		display: flex;
		align-items: center;
		justify-content: center;
		z-index: 9999;
		transition: all 1.2s cubic-bezier(0.76, 0, 0.24, 1);
	}

	.intro-overlay.hidden {
		opacity: 0;
		transform: scale(3);
		pointer-events: none;
	}

	.intro-content {
		text-align: center;
		animation: fadeInUp 1s ease-out;
	}

	.intro-title {
		font-family: var(--font-display);
		font-size: clamp(4rem, 15vw, 12rem);
		background: linear-gradient(
			135deg,
			var(--color-primary),
			var(--color-secondary),
			var(--color-accent)
		);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-clip: text;
		margin-bottom: 0;
		letter-spacing: 0.05em;
		text-shadow: 0 0 80px rgba(255, 0, 255, 0.5);
	}

	.intro-subtitle {
		font-size: clamp(1rem, 3vw, 2rem);
		color: var(--color-text-muted);
		margin-top: -1rem;
		letter-spacing: 0.3em;
		font-weight: 300;
		text-transform: uppercase;
	}

	.enter-btn {
		margin-top: 3rem;
		padding: 1rem 3rem;
		font-size: 1.2rem;
		font-weight: 700;
		letter-spacing: 0.2em;
		background: transparent;
		border: 2px solid var(--color-primary);
		color: var(--color-primary);
		cursor: pointer;
		position: relative;
		overflow: hidden;
		transition: all 0.3s ease;
		text-transform: uppercase;
		font-family: var(--font-body);
	}

	.enter-btn::before {
		content: "";
		position: absolute;
		top: 0;
		left: -100%;
		width: 100%;
		height: 100%;
		background: var(--color-primary);
		transition: left 0.3s ease;
		z-index: -1;
	}

	.enter-btn:hover::before {
		left: 0;
	}

	.enter-btn:hover {
		color: #000;
		box-shadow: 0 0 30px var(--color-primary);
	}

	/* Main Content */
	.main-content {
		opacity: 0;
		pointer-events: none;
		transition: opacity 0.6s ease 0.6s;
		height: 100vh;
		width: 100vw;
		position: relative;
		display: flex;
		align-items: center;
		justify-content: center;
		overflow: hidden;
	}

	.main-content.visible {
		opacity: 1;
		pointer-events: all;
	}

	/* Navigation Hints (Control Diagram) */
	.nav-hints {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		pointer-events: none;
	}

	.nav-hint {
		position: absolute;
		color: var(--color-text-muted);
		font-family: var(--font-display);
		text-transform: uppercase;
		font-size: 1.5rem;
		display: flex;
		flex-direction: column;
		align-items: center;
		opacity: 0.5;
		transition: all 0.3s ease;
	}

	.nav-hint span {
		text-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
	}

	.nav-hint small {
		font-family: var(--font-body);
		font-size: 0.8rem;
		opacity: 0.7;
		margin-top: 0.2rem;
	}

	.nav-hint.up {
		top: 2rem;
		left: 50%;
		transform: translateX(-50%);
	}
	.nav-hint.down {
		bottom: 2rem;
		left: 50%;
		transform: translateX(-50%);
	}
	.nav-hint.left {
		left: 2rem;
		top: 50%;
		transform: translateY(-50%) rotate(-90deg);
	}
	.nav-hint.right {
		right: 2rem;
		top: 50%;
		transform: translateY(-50%) rotate(90deg);
	}

	/* Terminal Styling */
	.terminal-container {
		width: 800px;
		max-width: 90%;
		background: rgba(10, 10, 12, 0.95);
		border: 1px solid #333;
		border-radius: 4px;
		box-shadow:
			0 0 50px rgba(0, 0, 0, 0.5),
			0 0 20px rgba(75, 159, 255, 0.1);
		backdrop-filter: blur(10px);
		display: flex;
		flex-direction: column;
		animation: glow 4s infinite alternate;
	}

	@keyframes glow {
		0% {
			box-shadow:
				0 0 50px rgba(0, 0, 0, 0.5),
				0 0 20px rgba(75, 159, 255, 0.05);
			border-color: #333;
		}
		100% {
			box-shadow:
				0 0 60px rgba(0, 0, 0, 0.6),
				0 0 30px rgba(75, 159, 255, 0.15);
			border-color: #444;
		}
	}

	.terminal-header {
		padding: 0.5rem 1rem;
		background: #1a1a1a;
		border-bottom: 1px solid #333;
		display: flex;
		align-items: center;
		gap: 0.5rem;
	}

	.status-dot {
		width: 10px;
		height: 10px;
		background: #00ff00;
		border-radius: 50%;
		box-shadow: 0 0 5px #00ff00;
	}

	.terminal-title {
		font-family: monospace;
		font-size: 0.9rem;
		color: #888;
		flex-grow: 1;
	}

	.api-status {
		font-size: 0.7rem;
		color: var(--color-primary);
		border: 1px solid var(--color-primary);
		padding: 0.1rem 0.4rem;
		border-radius: 2px;
	}

	.terminal-window {
		padding: 1.5rem;
		height: 400px;
		overflow-y: auto;
		font-family: "Courier New", Courier, monospace;
		color: #ccc;
		font-size: 1rem;
		line-height: 1.5;
	}

	.output-log {
		margin-bottom: 1rem;
	}

	.line {
		margin-bottom: 0.2rem;
	}
	.line.system {
		color: var(--color-secondary);
	}
	.line.warning {
		color: var(--color-accent);
	}
	.line.error {
		color: #ff4444;
	}
	.line.info {
		color: #888;
	}
	.line.link a {
		color: var(--color-primary);
		text-decoration: none;
		border-bottom: 1px dotted var(--color-primary);
	}
	.cmd {
		color: var(--color-primary);
		font-weight: bold;
	}

	.input-line {
		display: flex;
		align-items: center;
		gap: 0.5rem;
	}

	.prompt {
		color: #00ff00;
	}

	.vim-input {
		background: transparent;
		border: none;
		color: #fff;
		font-family: inherit;
		font-size: inherit;
		flex-grow: 1;
		outline: none;
		caret-color: transparent; /* Use custom cursor block */
	}

	.cursor-block {
		width: 10px;
		height: 1.2em;
		background: rgba(255, 255, 255, 0.5);
		animation: blink 1s step-end infinite;
		display: none; /* Only show if we simulate it, doing native caret for now but hidden */
	}

	/* Native input caret color restoration for usability, or style custom later */
	.vim-input {
		caret-color: #00ff00;
	}

	/* API Panel removed - configuration now in Agent Station */

	@keyframes fadeInUp {
		from {
			opacity: 0;
			transform: translateY(30px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}
</style>

<script>
	const enterBtn = document.getElementById("enterBtn");
	const intro = document.getElementById("intro");
	const mainContent = document.getElementById("mainContent");
	const terminalInput = document.getElementById("vimInput");
	const outputLog = document.getElementById("outputLog");

	// Global Navigation
	const navigate = (path) => {
		// Simple client-side navigation for now, can be upgraded to View Transitions
		window.location.href = path;
	};

	// Intro Transition
	enterBtn?.addEventListener("click", () => {
		intro?.classList.add("hidden");
		setTimeout(() => {
			mainContent?.classList.add("visible");
			terminalInput?.focus();
		}, 800);
	});

	// Terminal Logic
	terminalInput?.addEventListener("keydown", (e) => {
		if (e.key === "Enter") {
			// @ts-ignore
			const command = e.target.value.trim();
			// @ts-ignore
			e.target.value = ""; // Clear input

			const line = document.createElement("div");
			line.className = "line";
			line.innerHTML = `<span class="prompt">~</span> ${command}`;
			outputLog?.appendChild(line);

			processCommand(command);

			// Auto scroll
			const terminalWindow = document.getElementById("terminalWindow");
			if (terminalWindow)
				terminalWindow.scrollTop = terminalWindow.scrollHeight;
		}
	});

	function processCommand(cmd) {
		const response = document.createElement("div");
		response.className = "line info";

		const parts = cmd.split(" ");
		const action = parts[0].startsWith(":")
			? parts[0].substring(1).toLowerCase()
			: null;
		const args = parts.slice(1);

		if (action) {
			switch (action) {
				case "help":
					response.innerHTML = `
						<div style="color: var(--color-primary)">AVAILABLE COMMANDS:</div>
						<div>:help       - Show this message</div>
						<div>:clear      - Clear terminal</div>
						<div>:vimtutor   - Start Vim tutorial</div>
						<div>:lessons    - List all Vim lessons</div>
						<div>:lesson [n] - Start lesson number n (1-8)</div>
						<div>:games      - List Vim mini-games</div>
						<div>:play [game]- Play a Vim game</div>
						<div>:commands   - Show Vim command reference</div>
						<div>:tip        - Get a random Vim tip</div>
						<div>:connect [url] - Connect agent to external session</div>
						<div>:nav [u|d|l|r] - Navigate (Up, Down, Left, Right)</div>
					`;
					break;
				case "vimtutor":
					response.innerHTML = `
						<div style="color: var(--color-secondary)">â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</div>
						<div style="color: var(--color-primary); font-weight: bold">ğŸ“ VIM TUTORIAL - WELCOME</div>
						<div style="color: var(--color-secondary)">â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</div>
						<div style="margin-top: 0.5rem">Vim is a powerful text editor with a steep learning curve.</div>
						<div>This tutorial will teach you the essentials through 8 progressive lessons.</div>
						<div style="margin-top: 0.5rem; color: var(--color-accent)">ğŸ“š LESSONS AVAILABLE:</div>
						<div>  1. Basic Movement (h, j, k, l)</div>
						<div>  2. Word Movement (w, b, e)</div>
						<div>  3. Line Navigation (0, $, ^)</div>
						<div>  4. Insert Mode (i, a, o, O)</div>
						<div>  5. Delete & Change (d, c, x)</div>
						<div>  6. Search & Replace (/, ?, :s)</div>
						<div>  7. Visual Mode (v, V, Ctrl+v)</div>
						<div>  8. Undo & Redo (u, Ctrl+r)</div>
						<div style="margin-top: 0.5rem">Type <span class="cmd">:lesson 1</span> to start!</div>
						<div>Type <span class="cmd">:games</span> to see mini-games!</div>
					`;
					break;
				case "lessons":
					response.innerHTML = `
						<div style="color: var(--color-primary)">ğŸ“š VIM LESSONS:</div>
						<div>1. Basic Movement - Master h, j, k, l navigation</div>
						<div>2. Word Movement - Jump between words with w, b, e</div>
						<div>3. Line Navigation - Use 0, $, ^ for line jumps</div>
						<div>4. Insert Mode - Learn i, a, o, O for editing</div>
						<div>5. Delete & Change - Remove text with d, c, x</div>
						<div>6. Search & Replace - Find with / and replace with :s</div>
						<div>7. Visual Mode - Select text with v, V, Ctrl+v</div>
						<div>8. Undo & Redo - Master u and Ctrl+r</div>
						<div style="margin-top: 0.5rem">Use <span class="cmd">:lesson [number]</span> to start a lesson</div>
					`;
					break;
				case "lesson":
					if (args[0]) {
						const lessonNum = parseInt(args[0]);
						if (lessonNum >= 1 && lessonNum <= 8) {
							const lessons = [
								{ title: "Basic Movement", keys: "h, j, k, l", desc: "Move left, down, up, right" },
								{ title: "Word Movement", keys: "w, b, e", desc: "Next word, back word, end word" },
								{ title: "Line Navigation", keys: "0, $, ^", desc: "Start, end, first non-blank" },
								{ title: "Insert Mode", keys: "i, a, o, O", desc: "Insert, append, new line below/above" },
								{ title: "Delete & Change", keys: "x, dw, dd, cw", desc: "Delete char, word, line, change word" },
								{ title: "Search & Replace", keys: "/, ?, :s", desc: "Search forward/back, substitute" },
								{ title: "Visual Mode", keys: "v, V, Ctrl+v", desc: "Char, line, block selection" },
								{ title: "Undo & Redo", keys: "u, Ctrl+r", desc: "Undo last change, redo" }
							];
							const lesson = lessons[lessonNum - 1];
							response.innerHTML = `
								<div style="color: var(--color-secondary)">â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</div>
								<div style="color: var(--color-primary); font-weight: bold">ğŸ“– LESSON ${lessonNum}: ${lesson.title}</div>
								<div style="color: var(--color-secondary)">â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</div>
								<div style="margin-top: 0.5rem; color: var(--color-accent)">Keys: ${lesson.keys}</div>
								<div>Description: ${lesson.desc}</div>
								<div style="margin-top: 0.5rem; padding: 1rem; background: rgba(0,0,0,0.3); border-left: 3px solid var(--color-primary)">
									<div style="color: var(--color-secondary)">ğŸ¯ PRACTICE:</div>
									<div style="margin-top: 0.5rem; font-family: monospace; color: #fff">
										${lessonNum === 1 ? "Try typing: hjkl hjkl hjkl (move around!)" : ""}
										${lessonNum === 2 ? "Try: w w w (jump words) then b b b (back)" : ""}
										${lessonNum === 3 ? "Try: 0 (start) $ (end) ^ (first char)" : ""}
										${lessonNum === 4 ? "Try: i (type) ESC, a (type) ESC, o (new line)" : ""}
										${lessonNum === 5 ? "Try: x (delete char), dw (delete word), dd (delete line)" : ""}
										${lessonNum === 6 ? "Try: /word (search), n (next), :s/old/new (replace)" : ""}
										${lessonNum === 7 ? "Try: v (select), y (copy), p (paste)" : ""}
										${lessonNum === 8 ? "Make changes, then u (undo), Ctrl+r (redo)" : ""}
									</div>
								</div>
								<div style="margin-top: 0.5rem">ğŸ’¡ Tip: Practice in a real Vim editor for best results!</div>
								<div>Type <span class="cmd">:lesson ${lessonNum + 1}</span> for next lesson</div>
							`;
						} else {
							response.className = "line error";
							response.textContent = "Lesson number must be between 1 and 8";
						}
					} else {
						response.className = "line error";
						response.textContent = "Usage: :lesson [1-8]";
					}
					break;
				case "games":
					response.innerHTML = `
						<div style="color: var(--color-primary)">ğŸ® VIM MINI-GAMES:</div>
						<div style="margin-top: 0.5rem">
							<div>1. <span style="color: var(--color-accent)">speed-delete</span> [Easy] - Delete all X characters fast! (30s)</div>
							<div>2. <span style="color: var(--color-accent)">word-jump</span> [Medium] - Navigate to highlighted words (45s)</div>
							<div>3. <span style="color: var(--color-accent)">vim-golf</span> [Hard] - Transform text with minimum keystrokes (60s)</div>
							<div>4. <span style="color: var(--color-accent)">search-master</span> [Medium] - Find and replace patterns (40s)</div>
							<div>5. <span style="color: var(--color-accent)">visual-select</span> [Easy] - Select text blocks in visual mode (35s)</div>
							<div>6. <span style="color: var(--color-accent)">macro-madness</span> [Hard] - Record and replay macros (90s)</div>
						</div>
						<div style="margin-top: 0.5rem">Use <span class="cmd">:play [game-name]</span> to start a game</div>
						<div>Example: <span class="cmd">:play speed-delete</span></div>
					`;
					break;
				case "play":
					if (args[0]) {
						const games = {
							"speed-delete": {
								name: "Speed Delete",
								desc: "Delete all X characters as fast as possible!",
								time: 30,
								instructions: "Use 'x' to delete characters, 'f' to find next X, '/' to search"
							},
							"word-jump": {
								name: "Word Jump Challenge",
								desc: "Navigate to highlighted words using w/b/e",
								time: 45,
								instructions: "Use 'w' (next word), 'b' (back word), 'e' (end word)"
							},
							"vim-golf": {
								name: "Vim Golf",
								desc: "Transform text with minimum keystrokes",
								time: 60,
								instructions: "Complete the transformation in as few keys as possible"
							},
							"search-master": {
								name: "Search Master",
								desc: "Find and replace patterns quickly",
								time: 40,
								instructions: "Use '/' to search, ':s/old/new' to replace"
							},
							"visual-select": {
								name: "Visual Selection Race",
								desc: "Select specific text blocks in visual mode",
								time: 35,
								instructions: "Use 'v' (char), 'V' (line), Ctrl+v (block)"
							},
							"macro-madness": {
								name: "Macro Madness",
								desc: "Record and replay macros to edit repetitive text",
								time: 90,
								instructions: "Use 'q' to record, '@' to replay macros"
							}
						};
						const game = games[args[0]];
						if (game) {
							response.innerHTML = `
								<div style="color: var(--color-secondary)">â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</div>
								<div style="color: var(--color-accent); font-weight: bold">â„¹ï¸  VIM GAME: ${game.name.toUpperCase()}</div>
								<div style="color: var(--color-secondary)">â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</div>
								<div style="margin-top: 0.5rem; color: var(--color-accent)">âš ï¸  EDUCATIONAL REFERENCE ONLY</div>
								<div style="margin-top: 0.5rem">${game.desc}</div>
								<div style="color: var(--color-text-muted)">â±ï¸  Suggested Time: ${game.time} seconds</div>
								<div style="margin-top: 0.5rem; padding: 1rem; background: rgba(0,0,0,0.3); border-left: 3px solid var(--color-accent)">
									<div style="color: var(--color-secondary)">ğŸ“‹ HOW TO PLAY:</div>
									<div style="margin-top: 0.5rem">${game.instructions}</div>
								</div>
								<div style="margin-top: 0.5rem; padding: 1rem; background: rgba(139,69,19,0.2); border-left: 3px solid var(--color-primary)">
									<div style="color: var(--color-primary); font-weight: bold">ğŸ¯ TO ACTUALLY PLAY THIS GAME:</div>
									<div style="margin-top: 0.5rem">1. Install Vim: <a href="https://www.vim.org/download.php" target="_blank">vim.org/download</a></div>
									<div>2. Open a terminal and run: <span class="cmd">vim</span></div>
									<div>3. Try the challenge described above!</div>
									<div style="margin-top: 0.5rem; font-size: 0.9em; opacity: 0.8">These games are practice ideas, not playable in this browser.</div>
								</div>
								<div style="margin-top: 0.5rem">Type <span class="cmd">:games</span> to see all game ideas</div>
							`;
						} else {
							response.className = "line error";
							response.textContent = `Game not found. Type :games to see available games`;
						}
					} else {
						response.className = "line error";
						response.textContent = "Usage: :play [game-name]";
					}
					break;
				case "commands":
					response.innerHTML = `
						<div style="color: var(--color-primary)">ğŸ“– VIM COMMAND REFERENCE:</div>
						<div style="margin-top: 0.5rem; color: var(--color-secondary)">MOVEMENT:</div>
						<div>  h j k l - Left, Down, Up, Right</div>
						<div>  w b e - Next word, Back word, End word</div>
						<div>  0 $ ^ - Start, End, First non-blank</div>
						<div>  gg G - First line, Last line</div>
						<div>  { } - Previous/Next paragraph</div>
						<div style="margin-top: 0.5rem; color: var(--color-secondary)">EDITING:</div>
						<div>  i a o O - Insert before/after, New line below/above</div>
						<div>  x dd dw - Delete char, line, word</div>
						<div>  cc cw - Change line, word</div>
						<div>  r - Replace character</div>
						<div>  u Ctrl+r - Undo, Redo</div>
						<div style="margin-top: 0.5rem; color: var(--color-secondary)">VISUAL:</div>
						<div>  v V Ctrl+v - Char, Line, Block mode</div>
						<div>  y p P - Yank (copy), Paste after/before</div>
						<div style="margin-top: 0.5rem; color: var(--color-secondary)">SEARCH:</div>
						<div>  / ? - Search forward/backward</div>
						<div>  n N - Next/Previous match</div>
						<div>  * # - Search word under cursor</div>
						<div>  :s/old/new - Substitute</div>
						<div style="margin-top: 0.5rem; color: var(--color-secondary)">ADVANCED:</div>
						<div>  . - Repeat last command</div>
						<div>  q @ - Record/Play macro</div>
						<div>  % - Jump to matching bracket</div>
						<div>Type <span class="cmd">:vimtutor</span> to start learning!</div>
					`;
					break;
				case "tip":
					const tips = [
						"ğŸ’¡ Use 'ci\"' to change text inside quotes",
						"ğŸ’¡ '.' repeats your last command - super powerful!",
						"ğŸ’¡ Use '/' to search, then 'n' for next match",
						"ğŸ’¡ 'gg=G' auto-indents your entire file",
						"ğŸ’¡ Visual block mode (Ctrl+v) is great for columns",
						"ğŸ’¡ 'diw' deletes the word under cursor",
						"ğŸ’¡ Use marks with 'm' and jump with '`'",
						"ğŸ’¡ ':%s/old/new/g' replaces all occurrences",
						"ğŸ’¡ 'zz' centers the screen on cursor",
						"ğŸ’¡ Use 'f' to find a character on the line",
						"ğŸ’¡ '~' toggles case of character under cursor",
						"ğŸ’¡ 'J' joins the current line with the next",
						"ğŸ’¡ 'Ctrl+a' increments number under cursor",
						"ğŸ’¡ 'gU' converts to uppercase, 'gu' to lowercase",
						"ğŸ’¡ ':earlier 5m' goes back 5 minutes in time!"
					];
					response.innerHTML = tips[Math.floor(Math.random() * tips.length)];
					break;
				case "clear":
					if (outputLog) outputLog.innerHTML = "";
					return; // Don't append response
				case "connect":
					if (args.length > 0) {
						const url = args[0];
						response.innerHTML = `Opening link to <a href="${url}" target="_blank">${url}</a>...`;
						setTimeout(() => {
							window.open(url, "_blank");
						}, 1000);
					} else {
						response.className = "line error";
						response.textContent = "Usage: :connect <url>";
					}
					break;
				case "nav":
					// Allow CLI navigation
					if (args[0]) {
						const dir = args[0][0].toLowerCase();
						if (dir === "l") navigate("/toolkit");
						if (dir === "r") navigate("/desktop");
						if (dir === "u") logSystem("Upper levels locked.");
						if (dir === "d") logSystem("Lower levels locked.");
					}
					break;
				case "q":
				case "quit":
					response.textContent = "Session persistent. Cannot quit.";
					break;
				default:
					response.className = "line error";
					response.textContent = `E492: Not an editor command: ${action}`;
			}
		} else {
			response.className = "line error";
			response.textContent = `E488: Trailing characters (Use ':' for commands)`;
		}

		if (outputLog) outputLog.appendChild(response);
	}

	// Global Key Listener for "Control Diagram"
	document.addEventListener("keydown", (e) => {
		// Only navigate if we aren't typing in the input (unless it's empty? No, keep it simple)
		if (
			document.activeElement === terminalInput &&
			terminalInput.value !== ""
		) {
			return; // Allow cursor movement if typing
		}
		
		// If typing in API key input, don't navigate
		if (document.activeElement.tagName === "INPUT" || document.activeElement.tagName === "SELECT") {
			return;
		}

		switch (e.key) {
			case "ArrowUp":
				flashNav("up");
				logSystem("Navigating UP (Locked)...");
				break;
			case "ArrowDown":
				flashNav("down");
				logSystem("Navigating DOWN (Locked)...");
				break;
			case "ArrowLeft":
				flashNav("left");
				logSystem("Navigating to Tool Kit...");
				setTimeout(() => navigate("/toolkit"), 500);
				break;
			case "ArrowRight":
				flashNav("right");
				logSystem("Navigating to Agent OS...");
				setTimeout(() => navigate("/desktop"), 500);
				break;
		}
	});

	function flashNav(dir) {
		const hint = document.querySelector(`.nav-hint.${dir}`);
		if (hint) {
			hint.style.color = "#fff";
			hint.style.textShadow = "0 0 20px var(--color-primary)";
			hint.style.opacity = "1";
			setTimeout(() => {
				hint.style.color = "";
				hint.style.textShadow = "";
				hint.style.opacity = "";
			}, 300);
		}
	}

	function logSystem(msg) {
		const line = document.createElement("div");
		line.className = "line system";
		line.textContent = `[SYSTEM] ${msg}`;
		outputLog?.appendChild(line);
		const terminalWindow = document.getElementById("terminalWindow");
		if (terminalWindow)
			terminalWindow.scrollTop = terminalWindow.scrollHeight;
	}

</script>
