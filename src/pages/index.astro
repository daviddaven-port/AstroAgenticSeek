---
import Layout from "../layouts/Layout.astro";
import MainScreen from "../components/MainScreen.astro";
import VoiceAgentScreen from "../components/VoiceAgentScreen.astro";
import OpenOperatorAgentScreen from "../components/OpenOperatorAgentScreen.astro";
import DesktopOsScreen from "../components/DesktopOsScreen.astro";
---

<Layout>
	<!-- Screen Views -->
	<!-- We use CSS transforms to move between screens for that spatial feel -->
	<div id="viewport" class="viewport">
		<div class="screen-container center-screen" id="screen-center">
			<MainScreen />
		</div>
		<div class="screen-container up-screen" id="screen-up">
			<VoiceAgentScreen />
		</div>
		<div class="screen-container left-screen" id="screen-left">
			<OpenOperatorAgentScreen />
		</div>
		<div class="screen-container right-screen" id="screen-right">
			<DesktopOsScreen />
		</div>
	</div>

	<!-- Navigation Overlay (Always Visible on Center) -->
	<div class="nav-overlay" id="nav-overlay">
		<div class="nav-hint up"><span>▲</span> VOICE</div>
		<div class="nav-hint left"><span>◀</span> OPERATOR</div>
		<div class="nav-hint right">OS CLONE <span>▶</span></div>
		<div class="nav-hint down"><span>▼</span> DATA</div>
	</div>
</Layout>

<style>
	/* Viewport: The Window into the World */
	.viewport {
		position: relative;
		width: 100vw;
		height: 100vh;
		overflow: hidden;
		background: #000;
		transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
	}

	/* Screen Container: Holds each Page */
	.screen-container {
		position: absolute;
		width: 100vw;
		height: 100vh;
		top: 0;
		left: 0;
		transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
	}

	/* Positioning Screens Helpers */
	.center-screen {
		transform: translate3d(0, 0, 0);
		z-index: 10;
	}
	.up-screen {
		transform: translate3d(0, -100%, 0);
		z-index: 10;
	}
	.left-screen {
		transform: translate3d(-100%, 0, 0);
		z-index: 10;
	}
	.right-screen {
		transform: translate3d(100%, 0, 0);
		z-index: 10;
	}
	/* Down screen future implementation */

	/* Navigation HINTS */
	.nav-overlay {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		pointer-events: none;
		z-index: 100;
		opacity: 1;
		transition: opacity 0.3s;
	}

	.nav-hint {
		position: absolute;
		font-family: monospace;
		font-size: 0.8rem;
		color: rgba(255, 255, 255, 0.3);
		text-transform: uppercase;
		letter-spacing: 2px;
	}

	.nav-hint span {
		font-size: 1.2rem;
	}

	.nav-hint.up {
		top: 20px;
		left: 50%;
		transform: translateX(-50%);
	}
	.nav-hint.down {
		bottom: 20px;
		left: 50%;
		transform: translateX(-50%);
	}
	.nav-hint.left {
		left: 20px;
		top: 50%;
		transform: translateY(-50%);
	}
	.nav-hint.right {
		right: 20px;
		top: 50%;
		transform: translateY(-50%);
	}

	/* Hiding nav on other screens */
	body.nav-hidden .nav-overlay {
		opacity: 0;
	}
</style>

<script>
	// Navigation State
	let currentScreen = "center"; // center, up, left, right

	const viewport = document.getElementById("viewport");
	const screenCenter = document.getElementById("screen-center");
	const screenUp = document.getElementById("screen-up");
	const screenLeft = document.getElementById("screen-left");
	const screenRight = document.getElementById("screen-right");

	function navigateTo(screen: string) {
		if (currentScreen === screen) return;

		// Reset all transforms based on target
		// We actually want to move the VIEWPORT or the screens?
		// Moving screens relative to viewport is easier conceptually.

		// When going UP, we want the UP screen to come DOWN to 0, and CENTER to go DOWN to 100%
		// OR better: Move the whole relative container.
		// Let's use the transform on the individual screens for now, or just a simple state machine switch class.
		// Actually CSS classes are easiest for "Active" and "Inactive".

		switch (screen) {
			case "center":
				resetTransforms();
				document.body.classList.remove("nav-hidden");
				break;
			case "up":
				resetTransforms();
				// Slide UP screen down, Slide Center down
				if (screenUp) screenUp.style.transform = "translate3d(0, 0, 0)";
				if (screenCenter)
					screenCenter.style.transform = "translate3d(0, 100%, 0)";
				document.body.classList.add("nav-hidden");
				break;
			case "left":
				resetTransforms();
				if (screenLeft)
					screenLeft.style.transform = "translate3d(0, 0, 0)";
				if (screenCenter)
					screenCenter.style.transform = "translate3d(100%, 0, 0)";
				document.body.classList.add("nav-hidden");
				break;
			case "right":
				resetTransforms();
				if (screenRight)
					screenRight.style.transform = "translate3d(0, 0, 0)";
				if (screenCenter)
					screenCenter.style.transform = "translate3d(-100%, 0, 0)";
				document.body.classList.add("nav-hidden");
				break;
		}

		currentScreen = screen;
	}

	function resetTransforms() {
		if (screenCenter) screenCenter.style.transform = "translate3d(0, 0, 0)";
		if (screenUp) screenUp.style.transform = "translate3d(0, -100%, 0)";
		if (screenLeft) screenLeft.style.transform = "translate3d(-100%, 0, 0)";
		if (screenRight)
			screenRight.style.transform = "translate3d(100%, 0, 0)";
	}

	window.addEventListener("keydown", (e) => {
		// Prevent default only if necessary, but here we capture nav keys

		// If typing in an input, ignore navigation unless it is a modifier
		const activeTag = document.activeElement?.tagName.toLowerCase();
		if (activeTag === "input" || activeTag === "textarea") return;

		switch (e.key) {
			case "ArrowUp":
				if (currentScreen === "center") navigateTo("up");
				else if (currentScreen === "up") {
					/* Stay */
				} else navigateTo("center"); // Return to center from others
				break;
			case "ArrowDown":
				if (currentScreen === "up") navigateTo("center");
				// else if (currentScreen === 'center') navigateTo('down'); // TODO
				break;
			case "ArrowLeft":
				if (currentScreen === "center") navigateTo("left");
				else if (currentScreen === "right") navigateTo("center");
				break;
			case "ArrowRight":
				if (currentScreen === "center") navigateTo("right");
				else if (currentScreen === "left") navigateTo("center");
				break;
			case "Escape":
				navigateTo("center");
				break;
		}
	});

	// Listen for custom navigation events from components (like the terminal)
	window.addEventListener("navigate", (e: any) => {
		navigateTo(e.detail);
	});
</script>
